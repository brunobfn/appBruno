<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferramenta de Anotações com Backup</title>
    <style>
        textarea { width: 100%; height: 150px; }
        #notes { margin-top: 10px; }
        .note { margin-bottom: 10px; }
        .note-buttons { margin-left: 10px; }
        #gravar { background-color: #007bff; color: white; }
    </style>
</head>
<body>
    <textarea id="noteInput" placeholder="Digite sua nota aqui..."></textarea>
    <button onclick="saveNote()">Salvar Nota</button>
    <button id="gravar">Gravar</button>
    <div id="notes"></div>
    <script>
        const noteInput = document.getElementById('noteInput');
        const notesContainer = document.getElementById('notes');
        const gravarBtn = document.getElementById('gravar');
        let editingIndex = -1;
        let recognition;

        function saveNote() {
            const note = noteInput.value;
            if (note) {
                let notes = JSON.parse(localStorage.getItem('notes') || '[]');
                // Backup das notas antes de qualquer alteração
                backupNotes(notes);

                if (editingIndex > -1) {
                    // Editando nota existente
                    notes[editingIndex] = note;
                    editingIndex = -1;
                } else {
                    // Adicionando nova nota
                    notes.push(note);
                }
                localStorage.setItem('notes', JSON.stringify(notes));
                displayNotes();
                noteInput.value = '';
            }
        }

        function backupNotes(notes) {
            let backups = JSON.parse(localStorage.getItem('notesBackup') || '[]');
            const timestamp = new Date().toISOString();
            backups.push({ timestamp, notes });
            localStorage.setItem('notesBackup', JSON.stringify(backups));
        }

        function editNote(index) {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            noteInput.value = notes[index];
            editingIndex = index;
        }

        function deleteNote(index) {
            let notes = JSON.parse(localStorage.getItem('notes') || '[]');
            // Backup das notas antes de qualquer alteração
            backupNotes(notes);
            
            notes.splice(index, 1);
            localStorage.setItem('notes', JSON.stringify(notes));
            displayNotes();
        }

        function displayNotes() {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            notesContainer.innerHTML = notes.map((note, index) => `
                <div class="note">
                    <span>${note}</span>
                    <button class="note-buttons" onclick="editNote(${index})">Editar</button>
                    <button class="note-buttons" onclick="deleteNote(${index})">Excluir</button>
                </div>
            `).join('');
        }

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'pt-BR';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                noteInput.value += transcript;
            };

            recognition.onerror = (event) => {
                console.error('Erro no reconhecimento de voz:', event.error);
            };

            recognition.onend = () => {
                gravarBtn.disabled = false;
            };
        } else {
            gravarBtn.disabled = true;
            alert('Seu navegador não suporta reconhecimento de voz.');
        }

        gravarBtn.addEventListener('click', () => {
            if (recognition) {
                recognition.start();
                gravarBtn.disabled = true;
            }
        });

        displayNotes();
    </script>
</body>
</html>
